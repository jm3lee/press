#!/usr/bin/env bash
# Generate a sitemap.xml file from HTML files in a directory.
# Usage: sitemap [DIRECTORY]
# If DIRECTORY is not provided, defaults to build/.
set -euo pipefail

BUILD_DIR="${1:-build}"

# Find all HTML files relative to BUILD_DIR.
mapfile -t files < <(find "$BUILD_DIR" -type f -name '*.html' | sed "s|^$BUILD_DIR/||" | sort)

{
  echo '<?xml version="1.0" encoding="UTF-8"?>'
  echo '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'
  for f in "${files[@]}"; do
    echo "  <url><loc>/${f}</loc></url>"
  done
  echo '</urlset>'
} > build/sitemap.xml
